(globalThis.itsecWebpackJsonP=globalThis.itsecWebpackJsonP||[]).push([[3227],{1782:(e,a,t)=>{"use strict";t.r(a);var r=t(6293),s=t(3571),n=t(95122),d=t(48015),i=t(5638),o=t(64893),c=t(10906),l=t(92819),h=t(1528),u=t(9576);const m=(0,u.compose)([(0,d.withSelect)(((e,a)=>({dashboard:e("ithemes-security/dashboard").getDashboardForEdit(a.dashboardId)}))),(0,d.withDispatch)(((e,a)=>({remove(){const t=[];for(const e of a.dashboard.sharing)if("user"!==e.type)t.push(e);else if(e.users.includes(a.userId)){const r={...e,users:e.users.filter((e=>e!==a.userId))};t.push(r)}else t.push(e);return e("ithemes-security/dashboard").saveDashboard({...a.dashboard,sharing:t})}})))])((function(e){let{userId:a,user:t,remove:s}=e;const d=t?t.name:(0,n.sprintf)((0,n.__)("User #%d","it-l10n-ithemes-security-pro"),a),i=(0,h.getAvatarUrl)(t);return(0,r.createElement)(o.Dropdown,{className:"itsec-admin-bar-share__recipient itsec-admin-bar-share__recipient--user",contentClassName:"itsec-admin-bar-share__recipient-content itsec-admin-bar-share__recipient-content--user",headerTitle:(0,n.sprintf)((0,n.__)("Share Settings for %s","it-l10n-ithemes-security-pro"),d),focusOnMount:"container",expandOnMobile:!0,renderToggle:e=>{let{isOpen:a,onToggle:t}=e;return(0,r.createElement)(o.Tooltip,{text:d},(0,r.createElement)(o.Button,{"aria-pressed":a,"aria-label":d,onClick:t,className:"itsec-admin-bar-share__recipient-trigger",style:{backgroundImage:`url(${i})`}}))},renderContent:()=>(0,r.createElement)(r.Fragment,null,(0,r.createElement)("header",null,(0,r.createElement)("img",{src:i,alt:""}),(0,r.createElement)("h3",null,d)),(0,r.createElement)("footer",null,(0,r.createElement)(o.Button,{variant:"link",onClick:s},(0,n.__)("Remove","it-l10n-ithemes-security-pro"))))})}));var b=t(28952),p=t.n(b),_=t(51783);function g(e){let{dashboardId:a,role:t}=e;const{dashboard:s,roles:i}=(0,d.useSelect)((e=>({dashboard:e("ithemes-security/dashboard").getDashboardForEdit(a),roles:e("ithemes-security/core").getRoles()})),[a]),{saveDashboard:c}=(0,d.useDispatch)("ithemes-security/dashboard"),h=()=>{const e=[];for(const a of s.sharing)if("role"!==a.type)e.push(a);else if(a.roles.includes(t)){const r={...a,roles:a.roles.filter((e=>e!==t))};e.push(r)}else e.push(a);return c({...s,sharing:e})},u=(0,l.get)(i,[t,"label"],t),m=u.split(" ");let b;b=1===m.length?u.substring(0,2):m[0].substring(0,1).toUpperCase()+m[1].substring(0,1).toUpperCase();const g=_.l6[(e=>{let a=0;for(let t=0;t<e.length;t++)a+=e.charCodeAt(t);return a})(t)%_.l6.length];return(0,r.createElement)(o.Dropdown,{className:"itsec-admin-bar-share__recipient itsec-admin-bar-share__recipient--role",contentClassName:"itsec-admin-bar-share__recipient-content itsec-admin-bar-share__recipient-content--role",headerTitle:(0,n.sprintf)((0,n.__)("Share Settings for %s","it-l10n-ithemes-security-pro"),u),focusOnMount:"container",expandOnMobile:!0,renderToggle:e=>{let{isOpen:a,onToggle:t}=e;return(0,r.createElement)(o.Tooltip,{text:u},(0,r.createElement)(o.Button,{"aria-pressed":a,onClick:t,className:"itsec-admin-bar-share__recipient-trigger","aria-label":u,style:{backgroundColor:g}},(0,r.createElement)("span",{className:`itsec-admin-bar-share__role-abbr itsec-admin-bar-share__role-abbr--theme-${p()(g)}`},b)))},renderContent:()=>(0,r.createElement)(r.Fragment,null,(0,r.createElement)("header",null,(0,r.createElement)("h3",null,u)),(0,r.createElement)("footer",null,(0,r.createElement)(o.Button,{variant:"link",onClick:h},(0,n.__)("Remove","it-l10n-ithemes-security-pro"))))})}var E=t(19144),f=t(59588),N=t.n(f),y=t(87514),I=t.n(y),v=t(73470);const w=N()((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return a=>new Promise(((t,r)=>{I()({path:(0,v.addQueryArgs)("/wp/v2/users",{search:a,per_page:100,exclude:e})}).then((e=>t(e.map((e=>({value:e.id,label:e.name,user:e})))))).catch(r)}))})),D=(0,u.compose)([(0,d.withSelect)(((e,a)=>({user:e("ithemes-security/dashboard").getUser(a.userId)})))])((e=>{let{user:a}=e;return(0,r.createElement)("li",null,a.name)})),O=N()((function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return[].concat(...e.map((e=>e.users||[])))})),C=(0,u.compose)([(0,d.withSelect)(((e,a)=>({suggested:e("ithemes-security/dashboard").getSuggestedShareUsers(),dashboard:e("ithemes-security/dashboard").getDashboardForEdit(a.dashboardId)}))),(0,d.withDispatch)((e=>({receiveUser:e("ithemes-security/dashboard").receiveUser})))])((function(e){let{suggested:a,dashboard:t,share:s={type:"user",users:[]},onChange:d,receiveUser:i}=e;const[c,l]=(0,r.useState)(void 0),[h,u]=(0,r.useState)(""),m=O(t.sharing).concat(t.created_by),b=a.filter((e=>!m.includes(e.id)));return(0,r.createElement)(r.Fragment,null,b.length>0&&(0,r.createElement)("fieldset",{className:"itsec-share-dashboard__suggested-users"},(0,r.createElement)("legend",null,(0,n.__)("Suggested Users","it-l10n-ithemes-security-pro")),(0,r.createElement)("ul",null,b.map((e=>(0,r.createElement)("li",{key:e.id},(0,r.createElement)(o.CheckboxControl,{label:e.name,checked:s.users.includes(e.id),onChange:a=>d(a?{...s,users:[...s.users,e.id]}:{...s,users:s.users.filter((a=>a!==e.id))})})))))),(0,r.createElement)("fieldset",{className:"itsec-share-dashboard__add-users"},(0,r.createElement)("legend",null,(0,n.__)("All Users","it-l10n-ithemes-security-pro")),(0,r.createElement)("ul",null,s.users.filter((e=>!a.some((a=>a.id===e)))).map((e=>(0,r.createElement)(D,{key:e,userId:e})))),(0,r.createElement)("label",{className:"itsec-share-dashboard__add-users-select",htmlFor:"itsec-share-dashboard__add-users-select"},(0,n.__)("Select a User","it-l10n-ithemes-security-pro")),(0,r.createElement)("div",{className:"itsec-share-dashboard__add-users-fields"},(0,r.createElement)(E.qb,{className:"itsec-share-dashboard__add-users-select-dropdown",inputId:"itsec-share-dashboard__add-users-select",cacheOptions:!0,defaultOptions:!0,loadOptions:w(m),value:c,onChange:e=>l(e),inputValue:h,onInputChange:e=>u(e),maxMenuHeight:150,menuPlacement:"top"}),(0,r.createElement)("div",{className:"itsec-share-dashboard__add-users-trigger"},(0,r.createElement)(o.Button,{onClick:e=>{e.preventDefault(),c&&(i(c.user),d({...s,users:[...s.users,c.value]}),l(!1),u(""))},disabled:!c},(0,n.__)("Select","it-l10n-ithemes-security-pro"))))))})),k=N()(((e,a)=>e.some((e=>"role"===e.type&&e.roles.includes(a)))));function S(e){let{dashboardId:a,share:t={type:"role",roles:[]},onChange:s}=e;const{dashboard:i,roles:c}=(0,d.useSelect)((e=>({dashboard:e("ithemes-security/dashboard").getDashboardForEdit(a),roles:e("ithemes-security/core").getRoles()})),[a]),h=(0,l.pickBy)(c,((e,a)=>!k(i.sharing,a)));return(0,l.isEmpty)(h)?(0,r.createElement)("p",null,(0,n.__)("All roles already selected.","it-l10n-ithemes-security-pro")):(0,r.createElement)("ul",null,(0,l.map)(h,((e,a)=>(0,r.createElement)("li",{key:a},(0,r.createElement)(o.CheckboxControl,{label:e.label,checked:t.roles.includes(a),onChange:e=>s(e?{...t,roles:[...t.roles,a]}:{...t,roles:t.roles.filter((e=>a!==e))})})))))}const x=(0,l.once)((()=>[{name:"user",title:(0,n.__)("Users","it-l10n-ithemes-security-pro"),Component:C,type:"button",count:e=>(0,n.sprintf)((0,n._n)("%d user","%d users",e.users.length,"it-l10n-ithemes-security-pro"),e.users.length)},{name:"role",title:(0,n.__)("Roles","it-l10n-ithemes-security-pro"),type:"button",Component:S,count:e=>(0,n.sprintf)((0,n._n)("%d role","%d roles",e.roles.length,"it-l10n-ithemes-security-pro"),e.roles.length)}]));function L(e){let{dashboardId:a,close:t}=e;const[s,i]=(0,r.useState)({}),{isSaving:c,dashboard:h}=(0,d.useSelect)((e=>({isSaving:e("ithemes-security/dashboard").isSavingDashboard(a),dashboard:e("ithemes-security/dashboard").getDashboardForEdit(a)})),[a]),{saveDashboard:u}=(0,d.useDispatch)("ithemes-security/dashboard"),m=x(),b=m.reduce(((e,a)=>(s[a.name]&&e.push(a.count(s[a.name])),e)),[]);return(0,r.createElement)("form",{className:"itsec-share-dashboard-add",onSubmit:e=>e.preventDefault()},(0,r.createElement)("header",{className:"itsec-share-dashboard-add__header"},(0,r.createElement)("h3",null,(0,n.__)("Share Dashboard","it-l10n-ithemes-security-pro")),(0,r.createElement)("p",null,(0,n.__)("Give select users read-only access to this dashboard. Great for building client portals.","it-l10n-ithemes-security-pro"))),(0,r.createElement)(E.x4,{className:"itsec-share-dashboard-add__tab-panel",tabs:m,isStyled:!0},(e=>{let{name:t,Component:n=l.noop}=e;return(0,r.createElement)(n,{dashboardId:a,share:s[t],onChange:e=>i({...s,[t]:e})})})),(0,r.createElement)("footer",{className:"itsec-share-dashboard-add__footer"},b.length>0&&(0,r.createElement)("span",{className:"itsec-share-dashboard-add__summary"},(0,n.sprintf)((0,n.__)("%s selected","it-l10n-ithemes-security-pro"),b.join(", "))),(0,r.createElement)(o.Button,{variant:"primary",type:"submit",onClick:async e=>{e.preventDefault(),c||(await u({...h,sharing:[...h.sharing,...Object.values(s).filter((e=>e))]}),i({}),t())},isBusy:c,"aria-disabled":c},(0,n.__)("Share","it-l10n-ithemes-security-pro"))))}function U(e){let{dashboardId:a}=e;const{dashboard:t}=(0,d.useSelect)((e=>({dashboard:e("ithemes-security/dashboard").getDashboardForEdit(a)})),[a]),s=(0,l.get)(t,["_embedded","author",0]);return(0,r.createElement)("div",{className:"itsec-admin-bar__share"},s&&(0,r.createElement)("div",{className:"itsec-admin-bar-share__owner"},(0,r.createElement)(o.Tooltip,{text:s.name},(0,r.createElement)("span",{className:"itsec-admin-bar-share__recipient"},(0,r.createElement)("img",{className:"itsec-admin-bar-share__user-avatar",src:(0,h.getAvatarUrl)(s),alt:""})))),(0,r.createElement)("div",{className:"itsec-admin-bar-share__recipients"},(0,l.get)(t,"sharing",[]).filter((e=>"user"===e.type)).map((e=>e.users.map((s=>{return(0,r.createElement)(m,{share:e,userId:s,user:(n=s,(0,l.find)((0,l.get)(t,["_embedded","ithemes-security:shared-with"],[]),{id:n})),dashboardId:a,key:s});var n})))),(0,l.get)(t,"sharing",[]).filter((e=>"role"===e.type)).map((e=>e.roles.map((t=>(0,r.createElement)(g,{share:e,role:t,dashboardId:a,key:t})))))),(0,r.createElement)("div",{className:"itsec-admin-bar-share__add-share-container"},(0,r.createElement)(o.Dropdown,{className:"itsec-admin-bar-share__add-share",contentClassName:"itsec-admin-bar-share__add-share-content",position:"bottom",expandOnMobile:!0,focusOnMount:"container",headerTitle:(0,n.__)("Share with User","it-l10n-ithemes-security-pro"),renderToggle:e=>{let{isOpen:a,onToggle:t}=e;return(0,r.createElement)(o.Button,{label:(0,n.__)("Share Dashboard","it-l10n-ithemes-security-pro"),"aria-pressed":a,onClick:t,icon:"plus-alt",size:40})},renderContent:e=>{let{onClose:t}=e;return(0,r.createElement)(L,{dashboardId:a,close:t})}})))}var T=t(31511);function B(e){let{dashboardId:a}=e;const{dashboard:t}=(0,d.useSelect)((e=>({dashboard:e("ithemes-security/dashboard").getDashboard(a)})),[a]),s=(0,l.get)(t,["_embedded","author",0]);return!s||(0,T.k0)(s)?null:(0,r.createElement)("div",{className:"itsec-admin-bar__share"},s&&!(0,T.k0)(s)&&(0,r.createElement)("div",{className:"itsec-admin-bar-share__owner"},(0,r.createElement)(o.Tooltip,{text:s.name},(0,r.createElement)("span",{className:"itsec-admin-bar-share__recipient"},(0,r.createElement)("img",{className:"itsec-admin-bar-share__user-avatar",src:(0,h.getAvatarUrl)(s),alt:""})))))}var M=t(94184),P=t.n(M),F=t(82521);const A=(0,u.compose)([(0,d.withSelect)(((e,a)=>({currentDashboard:e("ithemes-security/dashboard").getViewingDashboardId(),isPrimary:e("ithemes-security/dashboard").getPrimaryDashboard()===a.dashboard.id,isDeleting:e("ithemes-security/dashboard").isDeletingDashboard(a.dashboard.id)}))),(0,d.withDispatch)(((e,a)=>({select:()=>e("ithemes-security/dashboard").viewDashboard(a.dashboard.id),setPrimary:()=>e("ithemes-security/dashboard").setPrimaryDashboard(a.dashboard.id),deleteDashboard:()=>e("ithemes-security/dashboard").deleteDashboard(a.dashboard.id)})))])((function(e){let{dashboard:a,currentDashboard:t,isPrimary:s,isDeleting:d,currentUserId:c,setPrimary:h,select:u,deleteDashboard:m,close:b}=e;const p=(0,i.decodeEntities)(a.label.rendered);return(0,r.createElement)("li",{className:P()("itsec-manage-dashboards__dashboard",{"itsec-manage-dashboard__dashboard--deleting":d})},(0,r.createElement)("header",{className:"itsec-manage-dashboards__dashboard-header"},(0,r.createElement)("h4",null,t===a.id?p:(0,r.createElement)(o.Button,{variant:"link",onClick:()=>[u(a.id),b()]},p),s&&(0,r.createElement)("span",{className:"itsec-manage-dashboards__primary"},(0,n.__)("Primary","it-l10n-ithemes-security-pro"))),c!==a.created_by&&(0,r.createElement)("span",{className:"itsec-manage-dashboards__dashboard-meta itsec-manage-dashboards__dashboard-meta--author"},(0,n.sprintf)((0,n.__)("Shared by %s","it-l10n-ithemes-security-pro"),(0,l.get)(a,["_embedded","author",0,"name"],(0,n.sprintf)((0,n.__)("User #%d","it-l10n-ithemes-security-pro"),a.created_by)))),(0,r.createElement)("span",{className:"itsec-manage-dashboards__dashboard-meta itsec-manage-dashboards__dashboard-meta--date"},(0,n.sprintf)((0,n.__)("Created on %s","it-l10n-ithemes-security-pro"),(0,F.dateI18n)("M j, Y",a.created_at)))),(0,r.createElement)("div",{className:"itsec-manage-dashboards__dashboard-actions"},!s&&(0,r.createElement)(o.Button,{variant:"link",onClick:h,className:"itsec-manage-dashboards__dashboard-action"},(0,n.__)("Make Primary","it-l10n-ithemes-security-pro")),a.id!==t&&!s&&c===a.created_by&&(0,r.createElement)(o.Button,{variant:"link",isDestructive:!0,onClick:m,className:"itsec-manage-dashboards__dashboard-action"},(0,n.__)("Delete","it-l10n-ithemes-security-pro"))))}));function R(e){let{close:a}=e;const{currentUserId:t,canCreate:s,dashboards:i}=(0,d.useSelect)((e=>({canCreate:e("ithemes-security/dashboard").canCreateDashboards(),dashboards:e("ithemes-security/dashboard").getAvailableDashboards(),currentUserId:e("ithemes-security/core").getCurrentUser()?.id||0})),[]),{viewCreateDashboard:c}=(0,d.useDispatch)("ithemes-security/dashboard");return(0,r.createElement)("div",{className:"itsec-manage-dashboards"},(0,r.createElement)("header",{className:"itsec-manage-dashboards__header"},(0,r.createElement)("h3",null,(0,n.__)("Manage Dashboards","it-l10n-ithemes-security-pro")),(0,r.createElement)("p",null,(0,n.__)("Switch, manage, or create new dashboards.","it-l10n-ithemes-security-pro"))),(0,r.createElement)("ul",{className:"itsec-manage-dashboards__list"},i.map((e=>(0,r.createElement)(A,{key:e.id,dashboard:e,currentUserId:t,close:a})))),s&&(0,r.createElement)("section",{className:"itsec-manage-dashboards__create"},(0,r.createElement)(o.Button,{variant:"link",onClick:()=>[c(),a()]},(0,n.__)("Create New Dashboard","it-l10n-ithemes-security-pro"))))}function j(){const{canEdit:e,canCreate:a,dashboards:t,dashboard:s,dashboardId:l}=(0,d.useSelect)((e=>{const a=e("ithemes-security/dashboard").getViewingDashboardId();return{dashboardId:a,canEdit:e("ithemes-security/dashboard").canEditDashboard(a),dashboard:e("ithemes-security/dashboard").getDashboard(a),canCreate:e("ithemes-security/dashboard").canCreateDashboards(),dashboards:e("ithemes-security/dashboard").getAvailableDashboards()}}),[]),h=(0,r.createElement)("h1",null,s?(0,i.decodeEntities)(s.label.rendered):(0,n.__)("No Dashboard Selected","it-l10n-ithemes-security-pro"));return(0,r.createElement)(c.AdminBarFill,{type:"primary"},(0,r.createElement)("div",{className:"itsec-admin-bar__title"},!a&&t.length<=1&&l?h:(0,r.createElement)(o.Dropdown,{className:"itsec-admin-bar-manage-dashboards__trigger",contentClassName:"itsec-admin-bar-manage-dashboards__content",position:"bottom right",headerTitle:(0,n.__)("Manage Dashboards","it-l10n-ithemes-security-pro"),expandOnMobile:!0,focusOnMount:"container",renderToggle:e=>{let{isOpen:a,onToggle:t}=e;return(0,r.createElement)(o.Button,{"aria-expanded":a,onClick:t,variant:"secondary"},h,(0,r.createElement)(o.Dashicon,{icon:a?"arrow-up-alt2":"arrow-down-alt2",size:15}))},renderContent:e=>{let{onClose:a}=e;return(0,r.createElement)(R,{dashboardId:l,close:a})}})),s&&(e?(0,r.createElement)(U,{dashboardId:l}):(0,r.createElement)(B,{dashboardId:l})))}function V(){return(0,r.createElement)(React.Fragment,null,(0,r.createElement)(j,null))}t.p=window.itsecWebpackPublicPath,(0,n.setLocaleData)({"":{}},"it-l10n-ithemes-security-pro"),(0,s.registerPlugin)("itsec-pro-dashboard",{render:()=>(0,r.createElement)(V,null)})},28952:(e,a,t)=>{var r=t(86189);e.exports=function(e){var a=r(e);return Math.round((299*parseInt(a[0])+587*parseInt(a[1])+114*parseInt(a[2]))/1e3)<=180?"dark":"light"}},86189:e=>{e.exports=function(e){e.charAt&&"#"===e.charAt(0)&&(e=function(e){var a=e.split("");return a.shift(),a.join("")}(e)),3===e.length&&(e=function(e){return e.split("").reduce((function(e,a){return e.concat([a,a])}),[]).join("")}(e));var a=parseInt(e,16);return[a>>16&255,a>>8&255,255&a]}},10906:e=>{e.exports=function(){return this.itsec.dashboard.api}()},1528:e=>{e.exports=function(){return this.itsec.dashboard.dashboard}()},31600:e=>{e.exports=function(){return this.itsec.packages.data}()},87514:e=>{e.exports=function(){return this.wp.apiFetch}()},64893:e=>{e.exports=function(){return this.wp.components}()},9576:e=>{e.exports=function(){return this.wp.compose}()},48015:e=>{e.exports=function(){return this.wp.data}()},82521:e=>{e.exports=function(){return this.wp.date}()},6293:e=>{e.exports=function(){return this.wp.element}()},5638:e=>{e.exports=function(){return this.wp.htmlEntities}()},95122:e=>{e.exports=function(){return this.wp.i18n}()},81834:e=>{e.exports=function(){return this.wp.isShallowEqual}()},81019:e=>{e.exports=function(){return this.wp.keycodes}()},3571:e=>{e.exports=function(){return this.wp.plugins}()},14776:e=>{e.exports=function(){return this.wp.primitives}()},73470:e=>{e.exports=function(){return this.wp.url}()},99196:e=>{"use strict";e.exports=window.React},91850:e=>{"use strict";e.exports=window.ReactDOM},92819:e=>{"use strict";e.exports=window.lodash}},e=>{e.O(0,[7271,4899,3075,1991,9144,1783],(()=>(1782,e(e.s=1782))));var a=e.O();((window.itsec=window.itsec||{})["pro-dashboard"]=window.itsec["pro-dashboard"]||{}).dashboard=a}]);