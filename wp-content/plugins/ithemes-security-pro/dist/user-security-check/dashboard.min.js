(globalThis.itsecWebpackJsonP=globalThis.itsecWebpackJsonP||[]).push([[4166],{26106:(e,t,r)=>{"use strict";r.r(t);var s=r(6293),a=r(95122),c=r(3571),n=r(48015),i=r(91991),l=r(92819),o=r(94184),u=r.n(o),d=r(64893),m=r(9576),h=r(54761),p=r(78380),f=r(1528),_=r(19144),y=r(82521),E=r(87514),w=r.n(E),g=r(31511);function N(e){switch(e){case"enabled":return["yes",(0,a.__)("Enabled","it-l10n-ithemes-security-pro")];case"not-enabled":return["no-alt",(0,a.__)("Not Enabled","it-l10n-ithemes-security-pro")];case"not-available":return["no-alt",(0,a.__)("Module Inactive","it-l10n-ithemes-security-pro")];case"enforced-not-configured":return["minus",(0,a.__)("Enforced, Not Configured","it-l10n-ithemes-security-pro")];default:return["minus",e]}}function b(e){switch(e){case 0:case 1:return["short",(0,a._x)("Very Weak","password strength","it-l10n-ithemes-security-pro")];case 2:return["bad",(0,a._x)("Weak","password strength","it-l10n-ithemes-security-pro")];case 3:return["good",(0,a._x)("Medium","password strength","it-l10n-ithemes-security-pro")];case 4:return["strong",(0,a._x)("Strong","password strength","it-l10n-ithemes-security-pro")];default:return["unknown",(0,a._x)("Unknown","password strength","it-l10n-ithemes-security-pro")]}}function x(e,t){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const{execute:a,status:c,value:n,error:o}=(0,i.r5)((0,s.useCallback)((r=>w()({url:e?.href,method:(0,l.isArray)(e?.methods)?e?.methods[0]:e?.methods,parse:!1,data:r}).then((e=>(t?.(e),g.x4.fromResponse(e)))).catch((async e=>function(e){throw e}(await g.x4.fromResponse(e))))),[e]),r);return I(c,n,o),{execute:a,status:c,value:n,error:o}}function I(e,t,r){const{createNotice:c,removeNotice:i}=(0,n.useDispatch)("core/notices"),o=(e,t)=>{const r=(0,l.uniqueId)("security-profile-action");c(e,t,{context:"ithemes-security",id:r}),setTimeout((()=>i(r,"ithemes-security")),5e3)};(0,s.useEffect)((()=>{if("error"===e){const e=(0,g.Y3)(r.error).join(" ");c("error",e||(0,a.__)("An unknown error occurred.","it-l10n-ithemes-security-pro"),{context:"ithemes-security"})}else"success"===e&&(t.success.length>0&&o("success",t.success.join(" ")),t.info.length>0&&o("info",t.info.join(" ")),t.warning.length>0&&o("warning",t.warning.join(" ")))}),[e,t,r])}function v(e){let{card:t,user:r}=e;return(0,s.createElement)("section",{className:"itsec-card-security-profile__user-info"},(0,s.createElement)("table",null,(0,s.createElement)("tbody",null,(0,s.createElement)("tr",null,(0,s.createElement)("th",null,(0,a.__)("Role","it-l10n-ithemes-security-pro")),(0,s.createElement)("td",null,r.role)),(0,s.createElement)("tr",null,(0,s.createElement)("th",null,(0,a.__)("Password Strength","it-l10n-ithemes-security-pro")),(0,s.createElement)("td",null,(0,s.createElement)("span",{className:u()("itsec-card-security-profile__password-strength",`itsec-card-security-profile__password-strength--${b(r.password_strength)[0]}`)},b(r.password_strength)[1]))),r.password_last_changed&&(0,s.createElement)("tr",null,(0,s.createElement)("th",null,(0,a.__)("Password Age","it-l10n-ithemes-security-pro")),(0,s.createElement)("td",null,(0,s.createElement)("span",{title:(0,y.dateI18n)("M d, Y g:s A",r.password_last_changed.time)},r.password_last_changed.diff))),(0,s.createElement)("tr",null,(0,s.createElement)("th",null,(0,a.__)("Two-Factor","it-l10n-ithemes-security-pro")),(0,s.createElement)("td",null,N(r.two_factor)[1])),r.last_active&&(0,s.createElement)("tr",null,(0,s.createElement)("th",null,(0,a.__)("Last Seen","it-l10n-ithemes-security-pro")),(0,s.createElement)("td",null,(0,s.createElement)("span",{title:(0,y.dateI18n)("M d, Y g:s A",r.last_active.time)},r.last_active.diff))))),(0,s.createElement)(O,{card:t,user:r}))}function O(e){let{card:t,user:r}=e;return(0,s.createElement)("div",{className:"itsec-card-security-profile__user-actions"},(0,s.createElement)(C,{card:t,user:r}),(0,s.createElement)(L,{card:t,user:r}))}function C(e){let{card:t,user:r}=e;const c=t._links?.["ithemes-security:send-2fa-reminder"]?.[0]?.href,{execute:n,status:l,value:o,error:u}=(0,i.r5)((0,s.useCallback)((()=>w()({url:c.replace("{user_id}",r.id),parse:!1,method:"POST"}).then(g.x4.fromResponse).catch((async e=>function(e){throw e}(await g.x4.fromResponse(e)))))),!1);return I(l,o,u),!c||"enforced-not-configured"!==r.two_factor&&"not-enabled"!==r.two_factor?null:(0,s.createElement)(d.Button,{isSmall:!0,variant:"primary",isBusy:"pending"===l,onClick:n},(0,a.__)("Send Two-Factor Reminder","it-l10n-ithemes-security-pro"))}function L(e){let{card:t,user:r}=e;const c=t._links?.["ithemes-security:logout"]?.[0]?.href,{execute:n,status:l,value:o,error:u}=(0,i.r5)((0,s.useCallback)((()=>w()({url:c.replace("{user_id}",r.id),parse:!1,method:"POST"}).then(g.x4.fromResponse).catch((async e=>function(e){throw e}(await g.x4.fromResponse(e)))))),!1);return I(l,o,u),c?(0,s.createElement)(d.Button,{isSmall:!0,variant:"secondary",isBusy:"pending"===l,onClick:n},(0,a.__)("Force Logout","it-l10n-ithemes-security-pro")):null}function k(e){let{master:t}=e;return(0,s.createElement)(React.Fragment,null,(0,s.createElement)("td",{className:"itsec-card-security-profile__users--column-avatar"},(0,s.createElement)("img",{src:t.avatar,alt:""})),(0,s.createElement)("th",{scope:"row",className:"itsec-card-security-profile__users--column-username"},t.name),(0,s.createElement)("td",{className:"itsec-card-security-profile__users--column-role"},t.role),(0,s.createElement)("td",{className:"itsec-card-security-profile__users--column-two-factor"},(0,s.createElement)(d.Dashicon,{icon:N(t.two_factor)[0]}),(0,s.createElement)("span",{className:"screen-reader-text"},N(t.two_factor)[1])))}function S(e){let{master:t,pinUser:r,profileCards:c,card:n}=e;return(0,s.createElement)("section",{className:"itsec-card-security-profile__user"},(0,s.createElement)("header",{className:"itsec-card-security-profile__user-header"},(0,s.createElement)("img",{src:t.avatar,alt:""}),(0,s.createElement)("h3",null,t.name),!c.includes(t.id)&&(0,s.createElement)(d.Button,{variant:"link",onClick:()=>r(t.id)},(0,a.__)("Pin","it-l10n-ithemes-security-pro"))),(0,s.createElement)(v,{user:t,card:n}))}function D(e){let{context:t}=e;const r=(0,m.useInstanceId)(D,"itsec-card-security-profile__filter-roles"),{roles:c,config:i,isQuerying:o}=(0,n.useSelect)((e=>({roles:e("ithemes-security/core").getRoles(),config:e("ithemes-security/dashboard").getAvailableCard(t.card),isQuerying:e("ithemes-security/dashboard").isQueryingDashboardCard(t.id)})),[t.id,t.card]),{queryDashboardCard:h}=(0,n.useDispatch)("ithemes-security/dashboard"),f=(0,s.useCallback)(((e,r)=>{h(t.id,{search:e,roles:r})}),[t.id]),y=(0,m.useDebounce)(f,300),[E,w]=(0,s.useState)(""),[g,N]=(0,s.useState)(!1),[b,x]=(0,s.useState)(i.query_args.roles?.default||[]);return(0,s.useEffect)((()=>y(E,b)),[E,b]),(0,s.createElement)("div",{className:u()("itsec-card-security-profile__filter",{"itsec-card-security-profile__filter--roles-visible":g,"itsec-card-security-profile__filter--has-roles":i.query_args.roles})},(0,s.createElement)("div",{className:"itsec-card-security-profile__filter-search"},(0,s.createElement)(p.lD,{value:E,onChange:w,label:(0,a.__)("Search Users","it-l10n-ithemes-security-pro"),placeholder:(0,a.__)("Search Users"),isSearching:o,surfaceVariant:"secondary"})),i.query_args.roles&&(0,s.createElement)(d.Button,{icon:"filter",onClick:()=>N(!g),"aria-expanded":g,"aria-controls":r},(0,a.sprintf)((0,a.__)("Roles (%d)","it-l10n-ithemes-security-pro"),b.length)),g&&(0,s.createElement)("ul",{id:r},(0,l.map)(c,((e,t)=>(0,s.createElement)("li",{key:t},(0,s.createElement)(_.Gs,{label:e.label,checked:b.includes(t),onChange:e=>x(e?[...b,t]:(0,l.without)(b,t))}))))))}function P(e){let{context:t}=e;const{refreshDashboardCard:r}=(0,n.useDispatch)("ithemes-security/dashboard"),a=t._links?.["ithemes-security:force-password-change"]?.[0],c=t._links?.["ithemes-security:clear-password-change"]?.[0],{execute:i,status:l}=x(a,(()=>r(t.id)),!1),{execute:o,status:u}=x(c,(()=>r(t.id)),!1);return a?(0,s.createElement)("footer",{className:"itsec-card-security-profile__footer"},(0,s.createElement)(_.aW,{isSmall:!0,variant:"primary",isBusy:"pending"===l||"pending"===u,text:a.title,onClick:()=>i(),controls:[c&&{title:c.title,onClick(){o()}}]})):null}const R={render:(0,m.compose)([m.withInstanceId,(0,n.withDispatch)(((e,t)=>({pinUser(r){e("ithemes-security/dashboard").saveDashboardCard(t.dashboardId,{card:"security-profile",settings:{user:r}})}}))),(0,n.withSelect)(((e,t)=>({profileCards:e("ithemes-security/dashboard").getDashboardCards(t.dashboardId).filter((e=>"security-profile"===e.card)).map((e=>(0,l.get)(e,["data","user","id"])))})))])((function(e){let{card:t,config:r,eqProps:c,profileCards:n,pinUser:l}=e;const[o,u]=(0,s.useState)(0),d=(0,i.vl)({pinUser:l,profileCards:n,card:t})(S),m=e=>u(e),h=c["max-width"]&&c["max-width"].includes("500px");return(0,s.createElement)("div",{className:"itsec-card--type-security-profile-list"},(0,s.createElement)(f.CardHeader,null,(0,s.createElement)(f.MasterDetailBack,{isSmall:h,select:m,selectedId:o}),(0,s.createElement)(f.CardHeaderTitle,{card:t,config:r}),(0,s.createElement)(f.CardHeaderStatus,null)),(0,s.createElement)(f.MasterDetail,{masters:t.data.users,detailRender:d,masterRender:k,ListHeader:D,ListFooter:P,selectedId:o,select:m,isSmall:h,context:t},(0,s.createElement)("thead",null,(0,s.createElement)("tr",null,(0,s.createElement)("th",{className:"itsec-card-security-profile__users--column-avatar"},(0,s.createElement)("span",{className:"screen-reader-text"},(0,a.__)("Avatar","it-l10n-ithemes-security-pro"))),(0,s.createElement)("th",{className:"itsec-card-security-profile__users--column-username"},(0,a.__)("Username","it-l10n-ithemes-security-pro")),(0,s.createElement)("th",{className:"itsec-card-security-profile__users--column-role"},(0,a.__)("Role","it-l10n-ithemes-security-pro")),(0,s.createElement)("th",{className:"itsec-card-security-profile__users--column-two-factor"},(0,a.__)("2FA","it-l10n-ithemes-security-pro"))))))})),elementQueries:[{type:"width",dir:"max",px:500},{type:"width",dir:"min",px:501},{type:"width",dir:"max",px:700}]};(0,h.addFilter)("ithemes-security.dashboard.getCardTitle.security-profile","ithemes-security/security-profile/default",(function(e,t){return t.data.user&&t.data.user.name?(0,a.sprintf)((0,a.__)("Security Profile – %s","it-l10n-ithemes-security-pro"),t.data.user.name):t.settings&&t.settings.user?(0,a.sprintf)((0,a.__)("User (%d) Security Profile","it-l10n-ithemes-security-pro"),t.settings.user):e}));var B=r(73470);const F=e=>new Promise(((t,r)=>{w()({path:(0,B.addQueryArgs)("/wp/v2/users",{search:e,per_page:100,itsec_global:!0})}).then((e=>t(e.map((e=>({value:e.id,label:e.name})))))).catch(r)})),T=(0,m.compose)([(0,n.withDispatch)(((e,t)=>({unPin:()=>e("ithemes-security/dashboard").removeDashboardCard(t.dashboardId,t.card),save:r=>e("ithemes-security/dashboard").saveDashboardCard(t.dashboardId,r)})))])((function(e){let{card:t,save:r}=e;const[c,n]=(0,s.useState)(0);return(0,s.createElement)("section",{className:"itsec-card-security-profile__select-user"},(0,s.createElement)("label",{htmlFor:`itsec-card-security-profile__select-user-dropdown--${t.id}`},(0,a.__)("Select a User","it-l10n-ithemes-security-pro")),(0,s.createElement)("form",{className:"itsec-card-security-profile__select-form"},(0,s.createElement)(_.qb,{addErrorBoundary:!1,className:"itsec-card-security-profile__select-user-dropdown",classNamePrefix:"itsec-card-security-profile__select-user-dropdown",inputId:`itsec-card-security-profile__select-user-dropdown--${t.id}`,cacheOptions:!0,defaultOptions:!0,loadOptions:F,value:c,onChange:e=>n(e),maxMenuHeight:150}),(0,s.createElement)("div",{className:"itsec-card-security-profile__select-user-save-container"},(0,s.createElement)(d.Button,{onClick:()=>r({...t,settings:{...t.settings||{},user:c.value}})},(0,a.__)("Select","it-l10n-ithemes-security-pro")))),(0,s.createElement)("p",{className:"description"},(0,a.__)("Select a user to monitor with this card.","it-l10n-ithemes-security-pro")))})),U={render:(0,m.compose)([(0,n.withSelect)(((e,t)=>({canEdit:e("ithemes-security/dashboard").canEditCard(t.dashboardId,t.card.id)})))])((function(e){let{card:t,config:r,canEdit:a,dashboardId:c}=e;const n=t.data.user;return(0,s.createElement)("div",{className:"itsec-card--type-security-profile"},n&&(0,s.createElement)("section",{className:"itsec-card-security-profile__user"},(0,s.createElement)("header",{className:"itsec-card-security-profile__user-header itsec-card__drag-handle"},(0,s.createElement)("img",{src:n.avatar,alt:""}),(0,s.createElement)("h3",null,n.name)),(0,s.createElement)(v,{user:n,card:t})),!n&&(0,s.createElement)(s.Fragment,null,(0,s.createElement)(f.CardHeader,null,(0,s.createElement)(f.CardHeaderTitle,{card:t,config:r})),a&&(0,s.createElement)(T,{card:t,dashboardId:c})))})),elementQueries:[{type:"width",dir:"max",px:250}]};function A(){const{registerCard:e}=(0,n.useDispatch)("ithemes-security/dashboard");return(0,i.eH)(A,(()=>{e("security-profile-list",R),e("security-profile",U)})),null}r.p=window.itsecWebpackPublicPath,(0,a.setLocaleData)({"":{}},"ithemes-security-pro"),(0,c.registerPlugin)("itsec-user-security-check-dashboard",{render:()=>(0,s.createElement)(A,null)})},1528:e=>{e.exports=function(){return this.itsec.dashboard.dashboard}()},31600:e=>{e.exports=function(){return this.itsec.packages.data}()},87514:e=>{e.exports=function(){return this.wp.apiFetch}()},64893:e=>{e.exports=function(){return this.wp.components}()},9576:e=>{e.exports=function(){return this.wp.compose}()},48015:e=>{e.exports=function(){return this.wp.data}()},82521:e=>{e.exports=function(){return this.wp.date}()},6293:e=>{e.exports=function(){return this.wp.element}()},54761:e=>{e.exports=function(){return this.wp.hooks}()},95122:e=>{e.exports=function(){return this.wp.i18n}()},81834:e=>{e.exports=function(){return this.wp.isShallowEqual}()},81019:e=>{e.exports=function(){return this.wp.keycodes}()},3571:e=>{e.exports=function(){return this.wp.plugins}()},14776:e=>{e.exports=function(){return this.wp.primitives}()},73470:e=>{e.exports=function(){return this.wp.url}()},99196:e=>{"use strict";e.exports=window.React},91850:e=>{"use strict";e.exports=window.ReactDOM},92819:e=>{"use strict";e.exports=window.lodash}},e=>{e.O(0,[7271,4899,3075,8380,1991,9144],(()=>(26106,e(e.s=26106))));var t=e.O();((window.itsec=window.itsec||{})["user-security-check"]=window.itsec["user-security-check"]||{}).dashboard=t}]);